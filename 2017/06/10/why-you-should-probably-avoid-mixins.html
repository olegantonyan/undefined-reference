<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
    <meta name="description" content="Mixins can be dangerous in many cases, avoid them if you can" />
    <meta property="og:description" content="description" />
  
  
    <meta name="keywords" content="ruby" />
  

  <meta property="og:url" content="https://undefined-reference.org/2017/06/10/why-you-should-probably-avoid-mixins.html" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://undefined-reference.org/assets/me_rounded.png" />
  <meta property="og:site_name" content="ruby and friends programming blog"/>

  
    <title>Why you should probably avoid mixins</title>
    <meta property="og:title" content="Why you should probably avoid mixins" />
  

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://undefined-reference.org/2017/06/10/why-you-should-probably-avoid-mixins.html">
  <link rel="alternate" type="application/rss+xml" title="undefined reference" href="https://undefined-reference.org/feed.xml">
  <link rel="stylesheet" href="/css/font-awesome-4.4.0/css/font-awesome.min.css">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">undefined reference</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
          <a class="page-link" href="/about/">About</a>
          
        
        <a class="page-link" href="/feed.xml">RSS</a>
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Why you should probably avoid mixins</h1>
    <i class="fa fa-tags"></i>
    
      <a href="/tag/ruby">ruby</a>
    
    <p class="post-meta"><i class="fa fa-calendar"></i>
      <time datetime="2017-06-10T05:35:28+00:00" itemprop="datePublished">Jun 10, 2017</time>
      
    </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>As you might have heard <a href="https://softwareengineering.stackexchange.com/questions/260343/why-is-inheritance-generally-viewed-as-a-bad-thing-by-oop-proponents">inheritance is evil</a>. I won’t argue, but indeed often inheritance is used improperly. The only legitimate usage of inheritance is creating more specific entity, not sharing the code. In this blog post I’ll assume that inheritance is evil when used for code sharing.</p>

<h3 id="mixins-are-another-syntax-for-inheritance">Mixins are another syntax for inheritance</h3>

<p>TL;TD And they are used for code sharing, thus mixins are evil.
Indeed, in Ruby included module becomes an implicit superclass with all perks of inheritance. And this can be abused.</p>

<h4 id="1-super-and-method-overriding">1) super and method overriding</h4>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">One</span>
  <span class="k">def</span> <span class="nf">func</span>
    <span class="nb">puts</span> <span class="s2">"in module"</span>
  <span class="k">end</span>  
<span class="k">end</span>  

<span class="k">class</span> <span class="nc">Two</span>
  <span class="kp">include</span> <span class="no">One</span>
  <span class="k">def</span> <span class="nf">func</span>
    <span class="nb">puts</span> <span class="s2">"in class"</span>
    <span class="k">super</span>
  <span class="k">end</span>  
<span class="k">end</span>

<span class="c1"># take a look at object hierarchy</span>
<span class="no">Two</span><span class="p">.</span><span class="nf">ancestors</span>
<span class="p">[</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="no">Two</span> <span class="o">&lt;</span> <span class="no">Object</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="no">One</span><span class="p">,</span>                  <span class="c1"># implicit superclass</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="no">Object</span> <span class="o">&lt;</span> <span class="no">BasicObject</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="no">PP</span><span class="o">::</span><span class="no">ObjectMixin</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="no">Kernel</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="no">BasicObject</span>
<span class="p">]</span>

<span class="c1"># call a function</span>
<span class="no">Two</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">func</span>
<span class="k">in</span> <span class="k">class</span>
<span class="k">in</span> <span class="n">module</span>    <span class="c1"># &lt;- yes, you can call `super`</span>
</code></pre></div></div>

<p>You can also include many modules with the same methods:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">One</span>
  <span class="k">def</span> <span class="nf">func</span>
    <span class="nb">puts</span> <span class="s2">"in one"</span>
  <span class="k">end</span>  
<span class="k">end</span>  

<span class="k">module</span> <span class="nn">Two</span>
  <span class="k">def</span> <span class="nf">func</span>
    <span class="nb">puts</span> <span class="s2">"in two"</span>
  <span class="k">end</span>  
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Three</span>
  <span class="kp">include</span> <span class="no">One</span>
  <span class="kp">include</span> <span class="no">Two</span>
  <span class="k">def</span> <span class="nf">func</span>
    <span class="nb">puts</span> <span class="s2">"in class"</span>
    <span class="k">super</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">Three</span><span class="p">.</span><span class="nf">ancestors</span>
<span class="p">[</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="no">Three</span> <span class="o">&lt;</span> <span class="no">Object</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="no">Two</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="no">One</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="no">Object</span> <span class="o">&lt;</span> <span class="no">BasicObject</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="no">PP</span><span class="o">::</span><span class="no">ObjectMixin</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="no">Kernel</span><span class="p">,</span>
    <span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="no">BasicObject</span>
<span class="p">]</span>

<span class="no">Three</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">func</span> <span class="c1">#=&gt; what do you expect here?</span>
</code></pre></div></div>

<p>The last example can be an interview question. It requires knowledge of how modules and inheritance actually work.</p>

<h4 id="2-they-have-access-to-instance-variables-of-a-class">2) they have access to instance variables of a class</h4>

<p>Being just a superclass, included module can access private instance variables of a child:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">One</span>
  <span class="k">def</span> <span class="nf">func</span>
    <span class="nb">puts</span> <span class="vi">@var</span>
  <span class="k">end</span>  
<span class="k">end</span>  

<span class="k">class</span> <span class="nc">Two</span>
  <span class="kp">include</span> <span class="no">One</span>
  <span class="k">def</span> <span class="nf">initialize</span>
    <span class="vi">@var</span> <span class="o">=</span> <span class="s1">'hello'</span>
  <span class="k">end</span>  
<span class="k">end</span>  

<span class="no">Two</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">func</span> <span class="c1">#=&gt; hello</span>
</code></pre></div></div>

<p>Same is true for private methods.</p>

<h3 id="evil-begins">Evil begins</h3>

<p>Now a developer can abuse mixins and make his code an unreadable mess. With good intentions, of course. For example, why not include 10 modules in 1 class? Now I have a “small” class and everything else spread across 10 entangled modules. Did I mention that you can call methods of another module from withing a module? Multiply this possibility by method overriding and instance variables and here comes a mess.</p>

<p>Is this really bad? <a href="https://www.youtube.com/watch?v=8bZh5LMaSmE">Yes! You should keep you classes and method small</a>, but when you split a big class into modules you make things worse. Now you have not only a big class, but a big class scattered across multiple files making it harder to read.</p>

<h3 id="conclusion">Conclusion</h3>

<p>Mixins are just cheaty syntax for inheritance intended for code sharing. Avoid them if you can. Prefer composition instead. This is true for any kind of inheritance, and especially for mixins.</p>

<p>In my opinion, the only legit case for mixins is when your module has no dependency on a class where it’s included. But even if it’s true for now doesn’t mean other developers cannot add dependency later. There is no barrier.</p>

<h3 id="links">Links</h3>
<ul>
  <li><a href="http://ruby-doc.com/docs/ProgrammingRuby/html/tut_modules.html">The Pragmatic Programmer’s Guide - Modules</a></li>
</ul>

  </div>

  <div class="social-share">
    <span class="reddit-share">
      <a href="//www.reddit.com/submit" onclick="window.location = '//www.reddit.com/submit?url=' + encodeURIComponent(window.location); return false"> <img src="//www.redditstatic.com/spreddit1.gif" alt="submit to reddit" border="0" /> </a>
    </span>
  </div>

</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-3">
        <ul class="contact-list">
          <li>Oleg Antonyan</li>
          <li>
            <a href="/about"><img src="/assets/me_rounded.png" height="60em" width="60em"></a>
          </li>
          <li>
            <div class="social-links">
  <a href="" target="_blank">
    <i class="fa fa-github"></i>
  </a>
  <a href="https://bitbucket.org/antlabs_dev" target="_blank">
    <i class="fa fa-bitbucket"></i>
  </a>
  <a href="http://stackoverflow.com/users/1837084/oleg-antonyan" target="_blank">
    <i class="fa fa-stack-overflow"></i>
  </a>
  <a href="https://www.linkedin.com/in/oleg-antonyan-2b715089" target="_blank">
    <i class="fa fa-linkedin"></i>
  </a>
  <a href="https://angel.co/oleg-antonyan" target="_blank">
    <i class="fa fa-angellist"></i>
  </a>
  <a href="https://www.facebook.com/100005362953409" target="_blank">
    <i class="fa fa-facebook"></i>
  </a>
</div>

          </li>
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>
          undefined reference :: ruby and friends programming blog
        </p>
        <p>
          Build with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a>, hosted on <a href="https://pages.github.com/" target="_blank">Github Pages</a>
        </p>
        <p>
          <a href="https://github.com/olegantonyan/undefined-reference" target="_blank">Source code</a>
        </p>
      </div>

    </div>

  </div>

</footer>


  </body>

</html>
