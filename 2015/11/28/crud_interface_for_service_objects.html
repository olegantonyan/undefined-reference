<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
    <meta name="description" content="Embrace CRUD interface to all of your domain objects" />
    <meta property="og:description" content="description" />
  
  
    <meta name="keywords" content="ruby, rails, ruby on rails, services, service objects rails, activemodel" />
  

  <meta property="og:url" content="https://undefined-reference.org/2015/11/28/crud_interface_for_service_objects.html" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://undefined-reference.org/assets/me_rounded.png" />
  <meta property="og:site_name" content="ruby and friends programming blog"/>

  
    <title>CRUD interface for service objects</title>
    <meta property="og:title" content="CRUD interface for service objects" />
  

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://undefined-reference.org/2015/11/28/crud_interface_for_service_objects.html">
  <link rel="alternate" type="application/rss+xml" title="undefined reference" href="https://undefined-reference.org/feed.xml">
  <link rel="stylesheet" href="/css/font-awesome-4.4.0/css/font-awesome.min.css">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">undefined reference</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
          <a class="page-link" href="/about/">About</a>
          
        
        <a class="page-link" href="/feed.xml">RSS</a>
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">CRUD interface for service objects</h1>
    <i class="fa fa-tags"></i>
    
      <a href="/tag/ruby">ruby</a>
    
      <a href="/tag/rails">rails</a>
    
    <p class="post-meta"><i class="fa fa-calendar"></i>
      <time datetime="2015-11-28T04:25:55+00:00" itemprop="datePublished">Nov 28, 2015</time>
      
    </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>Everybody knows about “service objects” concept. It’s an efficient way to DRY you models and follow single responsibility principle.</p>

<p>Here is my vision on how to do them right: use standard CRUD interface to them (<code class="language-plaintext highlighter-rouge">save</code>, <code class="language-plaintext highlighter-rouge">destroy</code>, etc).</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># app/services/base_service.rb</span>
<span class="k">class</span> <span class="nc">BaseService</span>
  <span class="kp">include</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Model</span>
  <span class="kp">include</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Validations</span>

  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">create!</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
    <span class="n">new</span><span class="p">(</span><span class="n">attrs</span><span class="p">).</span><span class="nf">save!</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">save!</span>
    <span class="k">raise</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">RecordInvalid</span><span class="p">,</span> <span class="nb">self</span> <span class="k">unless</span> <span class="n">save</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">destroy!</span>
    <span class="k">raise</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">RecordInvalid</span><span class="p">,</span> <span class="nb">self</span> <span class="k">unless</span> <span class="n">destroy</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># app/services/user/trial_service.rb</span>
<span class="k">class</span> <span class="nc">User::TrialService</span> <span class="o">&lt;</span> <span class="no">BaseService</span>
  <span class="nb">attr_accessor</span> <span class="ss">:user</span>

  <span class="n">validates</span> <span class="ss">:user</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>

  <span class="k">def</span> <span class="nf">save</span>
    <span class="k">return</span> <span class="kp">false</span> <span class="k">unless</span> <span class="n">valid?</span>
    <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="p">.</span><span class="nf">transaction</span> <span class="k">do</span>
      <span class="c1"># whatever logic to start a free trial for user</span>
    <span class="k">end</span>
    <span class="kp">true</span>
  <span class="k">rescue</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">RecordInvalid</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="n">errors</span><span class="p">.</span><span class="nf">add</span> <span class="ss">:base</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="nf">to_s</span>
    <span class="kp">false</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">destroy</span>
    <span class="c1"># end the trial for this user</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<p>Now you have uniform interface to all of your domain logic objects (models and services) and it’s much easier to use them in controllers. Also, it forces you to think about your domain logic in terms of CRUD interface, like REST and.</p>

<p>In the next post I’ll show why this is very useful.</p>

  </div>

  <div class="social-share">
    <span class="reddit-share">
      <a href="//www.reddit.com/submit" onclick="window.location = '//www.reddit.com/submit?url=' + encodeURIComponent(window.location); return false"> <img src="//www.redditstatic.com/spreddit1.gif" alt="submit to reddit" border="0" /> </a>
    </span>
  </div>

</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-3">
        <ul class="contact-list">
          <li>Oleg Antonyan</li>
          <li>
            <a href="/about"><img src="/assets/me_rounded.png" height="60em" width="60em"></a>
          </li>
          <li>
            <div class="social-links">
  <a href="" target="_blank">
    <i class="fa fa-github"></i>
  </a>
  <a href="https://bitbucket.org/antlabs_dev" target="_blank">
    <i class="fa fa-bitbucket"></i>
  </a>
  <a href="http://stackoverflow.com/users/1837084/oleg-antonyan" target="_blank">
    <i class="fa fa-stack-overflow"></i>
  </a>
  <a href="https://www.linkedin.com/in/oleg-antonyan-2b715089" target="_blank">
    <i class="fa fa-linkedin"></i>
  </a>
  <a href="https://angel.co/oleg-antonyan" target="_blank">
    <i class="fa fa-angellist"></i>
  </a>
</div>

          </li>
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>
          undefined reference :: ruby and friends programming blog
        </p>
        <p>
          Build with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a>, hosted on <a href="https://pages.github.com/" target="_blank">Github Pages</a>
        </p>
        <p>
          <a href="https://github.com/olegantonyan/undefined-reference" target="_blank">Source code</a>
        </p>
      </div>

    </div>

  </div>

</footer>


  </body>

</html>
